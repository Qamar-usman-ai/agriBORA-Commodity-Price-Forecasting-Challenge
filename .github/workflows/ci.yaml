name: AgriBORA-CI-Fixed

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: 1. Checkout Code
      uses: actions/checkout@v4 # Updated to v4 for 2026 standards
    
    - name: 2. Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: 3. Install Dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
        # Ensure pytest is installed if you use it later
        pip install streamlit pandas pytest 
    
    - name: 4. Verify Files Exist
      run: |
        echo "Searching for data files..."
        ls -la
        # Checking for the exact filenames in your repo
        test -f "forecasting.py" || (echo "❌ forecasting.py missing" && exit 1)
        test -f "agriBORA_maize_prices (1).csv" || (echo "❌ Main CSV missing" && exit 1)
    
    - name: 5. Test Python Logic
      run: |
        python -c "
        import pandas as pd
        try:
            # Note: I used the name exactly as it appears in your repo
            df = pd.read_csv('agriBORA_maize_prices (1).csv')
            print(f'✅ Successfully loaded {len(df)} rows')
        except Exception as e:
            print(f'❌ Error: {e}')
            exit(1)
        "

    - name: 6. Streamlit Smoke Test
      # This checks if the app starts without crashing
      run: |
        streamlit run forecasting.py --server.headless true & 
        sleep 5
        pkill streamlit
        echo "✅ Streamlit app started and closed successfully"
